{% extends 'base.html' %}

{% block main %}
<div class="container">
  <div class="row my-5">
    <div class="col-12 col-lg-6">
      <div class="bg-white border overflow-hidden">
        <img src="/{{ object.image }}" width="100%">
      </div>
    </div>
    <div class="col-12 col-lg-6">
      <div class="border p-3 text-left text-dark overflow-hidden">
        <h2 class="display-5">{{object.name}}</h2>
        <p class="lead">
          <a href="/categories/{{ object.category.slug }}/" class="badge bg-warning text-dark">
            {{ object.category.name }}
          </a>

          {% for tag in object.tags.all %}
          <a href="/tags/{{ tag.slug }}/" class="badge bg-light text-dark">
            #{{ tag }}
          </a>
          {% endfor %}
        </p>
        <p class="lead">¥{{object.price}}（税別）</p>
        <p class="lead">{{object.description}}</p>

        <form action="/items/{{object.pk}}/reserve/">
          {% csrf_token %}
          <p>
            {% if user.is_authenticated and user.is_paid %}
            <a href="{% url 'reserve' object.pk %}" class="btn btn-success">予約する</a>

            {% elif user.is_authenticated %}
            <a href="#subscribeModal" class="btn btn-dark" data-bs-toggle="modal">
              有料会員になると予約できます
            </a>

            {% else %}
            <a href="/login/" class="btn btn-secondary">
              ログインして予約
            </a>
            {% endif %}

          </p>
        </form>

        <form action="/create/" method="POST" class="">
          {% csrf_token %}
          <input type="hidden" name="item_pk" value="{{object.pk}}">
          <p>
            {% if user.is_authenticated and user.is_paid %}
            <a href="{% url 'create_review' object.id %}" class="btn btn-success">
              レビュー投稿
            </a>
            {% elif user.is_authenticated %}
            <a href="#subscribeModal" class="btn btn-dark" data-bs-toggle="modal">
              有料会員になるとレビューできます
            </a>
            {% else %}
            <a href="{% url 'login' %}" class="btn btn-secondary">
              ログインしてレビュー
            </a>
            {% endif %}
          </p>
        </form>
      </div>
    </div>
  </div>

  <hr>
  <h3 class="mt-5">レビュー</h3>

  {% for review in reviews %}
  <div class="border rounded p-3 mb-3">
    <strong>{{ review.user.username }}</strong>
    <span>★ {{ review.rating }}</span>
    <p class="mt-2">{{ review.comment }}</p>
  </div>
  {% empty %}
  <p class="text-muted">まだレビューはありません。</p>
  {% endfor %}

  <h2>おすすめ</h2>

  <div class="row mb-5">
    {% for item in ADDITIONAL_ITEMS %}
    <div class="col-12 col-lg-3 my-3">
      <div class="border p-3 h-100">

        <img src="/{{ item.image }}" class="img-fluid mb-2">

        <h5>{{ item.name }}</h5>

        <p class="mb-1">
          <a href="/categories/{{ item.category.slug }}" class="badge bg-warning text-dark">
            {{ item.category.name }}
          </a>
        </p>

        <p>
          {% for tag in item.tags.all %}
          <span class="badge bg-light text-dark">#{{ tag }}</span>
          {% endfor %}
        </p>

        <p>¥{{ item.price }}</p>

        {% if user.is_authenticated and user.is_paid %}
        <a href="{% url 'reserve' item.pk %}" class="btn btn-success btn-sm">
          予約
        </a>

        {% elif user.is_authenticated %}
        <a href="#" class="btn btn-dark btn-sm" data-bs-toggle="modal" data-bs-target="#subscribeModal">
          予約
        </a>

        {% else %}
        <a href="/login/" class="btn btn-dark btn-sm">
          ログインして予約
        </a>
        {% endif %}

      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}